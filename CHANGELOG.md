# 更新日志

本文档记录本项目的所有重要变更。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [1.2.4] - 当前版本

### style（样式/格式优化）
- 统一项目字体系统，所有模板和帮助页面使用项目自带字体（`p-med.ttf` 和 `p-bold.ttf`）
- 在 `common/common.css` 中定义统一的 `@font-face` 字体声明
- 更新所有模板 CSS 文件，统一使用 `ProjectD` 字体族
- 更新帮助页面配置文件（`config.yaml`），使用项目默认字体
- 更新 `StyleConfig.js` 默认字体配置
- 优化大红收藏记录模板（`redRecord.html`）样式
- 优化出红记录列表模板（`redRecordList.html`）样式
- 优化大红收藏海报模板（`redCollection.html`）样式
- 优化战绩和推送战绩模板的干员图片显示
- 统一所有模板的页脚样式
- 优化用户信息区域显示
- 完全重写音乐列表模板（`musicList.html` 和 `musicList.css`）
- 优化个人数据统计模板（`personalData.html`）
    - 改为左右两列布局（烽火地带和全面战场并排显示）
    - 优化头部布局，logo 在左，标题在右，同一行显示

### refactor（重构）
- 重构字体引用系统，移除对不存在字体文件的引用
- 统一字体命名规范，使用 `ProjectD` 作为主字体族名
- 合并 `red.js` 和 `RedCollection.js` 为统一文件，消除重复代码
    - 将 `getRedCollection()` 方法合并到 `red.js`，支持两种数据源
    - 提取公共方法 `parseUserInfo()`，统一用户信息解析逻辑
    - 根据命令参数自动选择数据源（出红记录 vs 收藏品详情）
    - 删除 `RedCollection.js` 文件，减少维护成本
- 重构出红记录功能，创建专用列表模板
    - 出红记录使用新的 `redRecordList.html` 模板，以列表形式展示
    - 大红收藏使用 `redCollection.html` 模板，保持原有海报样式
    - 根据数据源类型自动选择对应模板进行渲染
- 统一模板图标和品牌标识
    - 将所有模板中的图标和"三角洲行动"文字替换为统一的 `logo.png` 图片
    - 更新 `redRecord`、`redRecordList` 模板的图标显示方式
- 优化段位显示系统
    - 在 `redRecord`、`redRecordList`、`redCollection` 模板中添加段位图标显示
    - 段位图标仅使用 sol 模式（烽火地带），与游戏模式对应
    - 更新 `parseUserInfo()` 方法，自动获取段位图标路径

### fix（问题修复）
- 修复出红记录列表显示条数，默认显示前 6 条记录（按价值排序）
- 修复模板容器宽度问题，确保左右空隙对称
- 修复数字显示超出和对齐问题，确保在统计卡片上正确居中显示
- 修复战绩订阅推送日志，添加模式信息（烽火地带/全面战场）便于排查问题
    - 在所有关键日志中添加模式标识，区分烽火地带和全面战场推送
    - 优化推送处理日志，明确显示每条推送的模式类型
- 修复 `redCollection` 模板页脚位置问题，优化内容与页脚的间距

### perf（性能优化）
- 优化更新日志显示，仅显示当前版本和上一个版本，减少渲染内容

## [1.2.3] - 历史版本

### feat（新功能）
- 订阅战绩功能支持返回图片展示
- 更新 Guoba Web 配置
- 更新战绩背景显示地图
- 增加大红藏品图片渲染、大红查询图片渲染

### refactor（重构）
- 优化 resources 文件夹内的图片文件存储结构，全部移动至 imgs 文件夹内
- 优化配置文件存放逻辑，区分默认配置与用户配置
    - 外层 `config/` 存放默认配置（提交到 Git）
    - 内层 `config/config/` 存放用户配置和运行时生成的数据（不提交）
    - 订阅配置自动迁移到新目录

### style（样式/格式优化）
- 优化大红藏品查询模板样式

### chore（其他）
- 更新 `.gitignore` 规则，完善忽略配置

## [1.2.2] - 历史版本

### feat（新功能）
- 帮助菜单支持动态配置文件（`help.yaml`）
- 支持帮助配置热重载，修改配置文件后无需重启插件
- API 基础地址管理支持多模式（`auto`, `default`, `eo`, `esa`）
- API 自动故障转移机制，支持 `auto` 模式下的自动切换
- 帮助菜单分为两个独立页面（`^帮助` 和 `^娱乐帮助`）
- 帮助菜单支持两列布局配置
- 帮助组支持 `fullWidth` 属性，可跨两列显示
- 帮助组支持 `column` 属性，可指定显示在左列或右列
- 帮助组支持 `masterOnly` 属性，仅主人可见
- 帮助菜单支持多主题配置系统（`resources/help/imgs/` 目录）
- 帮助菜单样式配置支持热重载（`config.yaml`）
- 帮助菜单样式配置支持字体、字体大小等自定义
- 更新日志使用可视化模板渲染（`version-info.html`）
- 战绩查询使用可视化模板渲染（`record.html`），支持科技风卡片展示
- 个人数据统计使用可视化模板渲染（`personalData.html`），支持双栏布局
- 音乐列表使用可视化模板渲染（`musicList.html`），支持封面展示和排行榜

### refactor（重构）
- 重构 apps 目录结构，按功能分类组织文件
- 重构帮助菜单样式配置系统，从 JavaScript 迁移到 YAML
- 重构战绩查询功能，从纯文本转发消息迁移到可视化模板
- 重构个人数据统计功能，从纯文本消息迁移到可视化模板

### style（样式/格式优化）
- 优化帮助菜单布局，合并相似功能组
- 优化帮助菜单分组，提高可读性
- 优化帮助菜单配置结构，移除未使用的配置项
- 优化帮助菜单资源路径，支持主题动态切换
- 优化帮助菜单背景图片加载，使用绝对路径确保资源正确显示
- 优化帮助菜单左右列平衡，实现每列约18行命令的均衡布局
- 优化帮助菜单组排序，支持 `order` 属性精确控制显示顺序
- 优化帮助菜单全宽组显示，支持顶部和底部分区渲染
- 优化更新日志显示配色，采用金黄色主题与背景协调
- 优化更新日志卡片透明度，增强毛玻璃效果
- 优化更新日志视觉层次，提升阴影和圆角效果
- 优化更新日志文字可读性，调整颜色和行高
- 优化战绩卡片整体视觉设计，采用半透明背景和毛玻璃效果
- 优化战绩状态标签，撤离成功显示绿色，失败显示红色，退出显示橙色
- 优化战绩卡片布局，修复左右内边距不对称问题（统一为20px）
- 战绩卡片支持动态地图背景图，根据地图名称自动匹配对应背景
- 战绩卡片支持动态干员图片，显示在右侧并带有从左到右的渐变遮罩效果
- 优化战绩击杀数据展示，干员击杀显示绿色，AI玩家击杀显示红色，其他AI击杀显示橙色

### perf（性能优化）
- 优化 API 请求错误处理和重试机制
- 优化日志系统，减少冗余日志输出
- 调整日志等级，提升日志可读性
- 优化数据管理器初始化日志
- 优化 JSON 数据加载状态显示
- 优化数据同步日志输出，将详细信息改为 debug 级别
- 优化更新日志显示，使用模板渲染替代纯文本

### fix（问题修复）
- 修复帮助菜单显示过长的问题
- 修复帮助菜单列宽计算问题
- 修复两列布局不平衡的问题
- 修复个人信息页面时间显示格式问题
- 修复时间显示换行问题，增加宽度并防止换行
- 修复文件移动后导入路径错误的问题

## [1.2.1 ~ 1.0.0] - 早期版本

### 基础功能...

---

## 版本号更新规则

版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/) 规范，格式为 `主版本号.次版本号.修订号`（MAJOR.MINOR.PATCH）：

- **主版本号（MAJOR）**：当进行不兼容的 API 变更或重大架构调整时递增，例如 `1.2.2` → `2.0.0`
- **次版本号（MINOR）**：当添加向下兼容的新功能时递增，PATCH 归零，例如 `1.2.2` → `1.3.0`
- **修订号（PATCH）**：当进行向下兼容的问题修复时递增，例如 `1.2.2` → `1.2.3`

### 版本号更新时机

- **仅修复（fix）**：更新 PATCH，如 `1.2.2` → `1.2.3`
- **新增功能（feat）**：更新 MINOR，如 `1.2.2` → `1.3.0`
- **重大变更或优化**：通常更新 MINOR，如 `1.2.2` → `1.3.0`
- **不兼容变更**：更新 MAJOR，如 `1.2.2` → `2.0.0`

### 更新 CHANGELOG 的步骤

1. 在文件顶部添加新版本条目：`## [新版本号] - 发布日期或"未发布"`
2. 将当前版本内容移到新版本下
3. 同步更新 `package.json` 中的 `version` 字段
4. 将旧版本条目移动到历史版本部分

## 更新类型说明

遵循 [Conventional Commits](https://www.conventionalcommits.org/) 规范：

- **feat**: 新功能（feature）
- **fix**: 问题修复（bug fix）
- **docs**: 文档更新（documentation）
- **style**: 代码格式、样式调整（不影响代码运行的变动）
- **refactor**: 代码重构（既不是新功能也不是 bug 修复）
- **perf**: 性能优化（performance）
- **test**: 测试相关（tests）
- **chore**: 构建过程或辅助工具的变动
- **build**: 构建系统或外部依赖的变更
- **ci**: CI 配置文件和脚本的变更
- **revert**: 回滚之前的 commit

